<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>sbotto.io - Reset demo</title>
<style>
body{
  font-family:"Arial Rounded MT Bold", Arial, sans-serif;
  background:#f3efe6; margin:0; padding:20px;
}
.container{max-width:1200px; margin:auto; text-align:center;}
h1{margin-bottom:10px;}

#board{
  position:relative; width:100%; min-height:400px;
  background:#fafafa; border:2px dashed #ccc; overflow:hidden;
  margin-top:20px;
}

.note{
  width:130px; height:130px; padding:14px 10px;
  border-radius:2px; position:absolute;
  background:linear-gradient(135deg,#fff59d,#fdd835);
  display:flex; justify-content:center; align-items:center;
  font-weight:bold;
}

/* contatore */
#counterBox {
  margin-top:10px; font-size:14px; color:#444;
}

/* tasto reset nascosto */
#resetBtn {
  margin-top:20px;
  padding:8px 14px;
  background:#c62828;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
  display:none; /* ← tienilo nascosto */
}
#resetBtn:hover { background:#b71c1c; }
</style>
</head>
<body>
  <div class="container">
    <h1>📌 Sbotto.io</h1>
    <textarea id="noteInput" placeholder="Scrivi qui il tuo post-it (max 40 caratteri)..."></textarea><br>
    <button onclick="aggiungiNota()">Pubblica Post-it</button>
    <div id="counterBox">📝 Totale post-it: 0</div>
    <div id="board"></div>

    <!-- Tasto reset (nascondilo o usalo solo tu) -->
    <button id="resetBtn" onclick="resetTutto()">🔄 Reset Totale</button>
  </div>

  <!-- GUN -->
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script>
  const gun = Gun({
    peers:[
      "https://gun.database.eco/gun",
      "https://peer.wallie.io/gun",
      "https://gun-altcoins.herokuapp.com/gun"
    ]
  });

  const notesDB = gun.get("p2p-postit");
  const counterDB = gun.get("p2p-postit-counter");
  let store = {};
  let totalCounter = 0;

  function render(){
    const board = document.getElementById("board");
    board.innerHTML="";
    Object.values(store).forEach(n=>{
      if(!n || n.deleted) return;
      const div = document.createElement("div");
      div.className = "note";
      div.style.left = (n.x||0)+"px";
      div.style.top  = (n.y||0)+"px";
      div.textContent = n.text;
      board.appendChild(div);
    });
  }

  function aggiungiNota(){
    let text = document.getElementById("noteInput").value.trim();
    if(!text) return alert("Scrivi qualcosa!");
    if(text.length > 40) text = text.substring(0,37)+"...";
    const board = document.getElementById("board");
    const maxX = Math.max(0, board.clientWidth-150);
    const maxY = Math.max(0, board.clientHeight-150);

    let note = {
      id: Gun.text.random(16),
      text,
      date: Date.now(),
      x: Math.floor(Math.random()*maxX),
      y: Math.floor(Math.random()*maxY)
    };

    notesDB.get(note.id).put(note);

    // incrementa contatore globale
    counterDB.get("total").once(val=>{
      const current = val || 0;
      counterDB.get("total").put(current + 1);
    });

    document.getElementById("noteInput").value="";
  }

  // reset totale: cancella tutti i post-it e azzera il contatore
  function resetTutto(){
    if(!confirm("⚠️ Sei sicuro di voler cancellare tutto?")) return;

    // cancella post-it
    notesDB.map().once((n,id)=>{
      notesDB.get(id).put(null);
    });

    // azzera contatore
    counterDB.get("total").put(0);

    // pulisci localStorage
    localStorage.removeItem("sbotto-notes");
    localStorage.removeItem("p2p-postit-counter");

    store = {};
    render();
    document.getElementById("counterBox").textContent = "📝 Totale post-it: 0";
  }

  // Ascolta database
  notesDB.map().on((n,id)=>{
    if(!n || !n.id || n.deleted){ delete store[id]; }
    else { store[id]=Object.assign(store[id]||{}, n); }
    render();
  });

  // Ascolta contatore
  counterDB.get("total").on(val=>{
    totalCounter = val || 0;
    document.getElementById("counterBox").textContent = "📝 Totale post-it: " + totalCounter;
  });
  </script>
</body>
</html>
